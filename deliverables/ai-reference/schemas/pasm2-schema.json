{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://ironsheepproductionsllc.github.io/P2-Knowledge-Base/schemas/pasm2-schema.json",
  "title": "PASM2 Instruction Schema",
  "description": "JSON schema for Parallax Propeller 2 PASM2 assembly instructions",
  "version": "1.0.0",
  "type": "object",
  "properties": {
    "name": {
      "type": "string",
      "pattern": "^[A-Z][A-Z0-9]*$",
      "description": "Instruction mnemonic (e.g., ADD, MOV, JMP)"
    },
    "category": {
      "type": "string",
      "enum": [
        "arithmetic",
        "logic", 
        "bitwise",
        "shift-rotate",
        "comparison",
        "branch-jump",
        "call-return",
        "hub-memory",
        "cog-lut",
        "smart-pins",
        "events",
        "interrupts",
        "debug",
        "misc"
      ],
      "description": "Functional category of instruction"
    },
    "description": {
      "type": "string",
      "minLength": 10,
      "description": "Brief description of what the instruction does"
    },
    "syntax": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "minItems": 1,
      "description": "Valid syntax forms (e.g., ['ADD D,S', 'ADD D,#S'])"
    },
    "parameters": {
      "type": "object",
      "properties": {
        "dest": {
          "type": "object",
          "properties": {
            "required": {"type": "boolean"},
            "type": {
              "type": "string",
              "enum": ["register", "immediate", "address", "any"]
            },
            "range": {"type": "string"},
            "description": {"type": "string"}
          },
          "required": ["required", "type"]
        },
        "source": {
          "type": "object", 
          "properties": {
            "required": {"type": "boolean"},
            "type": {
              "type": "string",
              "enum": ["register", "immediate", "address", "any"]
            },
            "range": {"type": "string"},
            "description": {"type": "string"}
          },
          "required": ["required", "type"]
        }
      }
    },
    "encoding": {
      "type": "object",
      "properties": {
        "opcode": {
          "type": "string",
          "pattern": "^[01x]{32}$",
          "description": "32-bit instruction encoding pattern"
        },
        "fields": {
          "type": "object",
          "properties": {
            "INSTR": {"type": "string"},
            "CZ": {"type": "string"},
            "I": {"type": "string"},
            "DEST": {"type": "string"},
            "SRC": {"type": "string"}
          }
        }
      },
      "required": ["opcode"]
    },
    "timing": {
      "type": "object",
      "properties": {
        "cogRam": {
          "type": "integer",
          "minimum": 1,
          "description": "Clock cycles when executing from COG RAM"
        },
        "lutRam": {
          "type": "integer", 
          "minimum": 1,
          "description": "Clock cycles when executing from LUT RAM"
        },
        "hubRam": {
          "type": "integer",
          "minimum": 1,
          "description": "Clock cycles when executing from HUB RAM"
        },
        "notes": {
          "type": "string",
          "description": "Timing notes and conditions"
        }
      },
      "required": ["cogRam"]
    },
    "flags": {
      "type": "object",
      "properties": {
        "affects": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["C", "Z", "both", "none"]
          },
          "description": "Which flags the instruction affects"
        },
        "optional": {
          "type": "boolean",
          "description": "Whether flag writing is optional (WC, WZ modifiers)"
        }
      },
      "required": ["affects"]
    },
    "conditions": {
      "type": "object",
      "properties": {
        "supported": {
          "type": "boolean",
          "description": "Whether instruction supports conditional execution"
        },
        "codes": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^(IF_|_IF_)?[A-Z0-9_]+$"
          },
          "description": "Supported condition codes (e.g., IF_Z, IF_NZ)"
        }
      },
      "required": ["supported"]
    },
    "aliases": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Alternative instruction names or forms"
    },
    "examples": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "code": {"type": "string"},
          "description": {"type": "string"},
          "registers": {"type": "object"}
        },
        "required": ["code", "description"]
      },
      "description": "Usage examples with explanations"
    },
    "notes": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Important notes, gotchas, or special behaviors"
    },
    "trustLevel": {
      "type": "string",
      "enum": ["verified", "community", "unknown"],
      "description": "Documentation confidence level"
    },
    "sourceRefs": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "document": {"type": "string"},
          "page": {"type": "string"},
          "section": {"type": "string"}
        },
        "required": ["document"]
      },
      "description": "Source document references"
    }
  },
  "required": [
    "name", 
    "category", 
    "description", 
    "syntax", 
    "encoding", 
    "timing", 
    "flags",
    "conditions",
    "trustLevel"
  ],
  "additionalProperties": false
}