# Smart Pin Mode %00001 - Long Repository or DAC Noise
# Source: Silicon Doc v35, part4-smart-pins.txt

mode_id: "%00001"
mode_name: "Long Repository or DAC Noise"
description: "Dual functionality based on M[12:10] setting - either long repository storage or DAC noise generation"
category: "storage_dac"
output_override: false

configuration:
  wrpin_format:
    description: "D/# = %AAAA_BBBB_FFF_MMMMMMMMMMMMM_TT_SSSSS_0"
    sssss_value: "%00001"

  mode_selection:
    long_repository: "M[12:10] != %101"
    dac_noise: "M[12:10] = %101"

# Long Repository Mode
long_repository_mode:
  condition: "M[12:10] != %101"
  description: "Smart pin acts as a long repository for data storage"
  
  behavior:
    active_state: "DIR=1"
    reset_state: "DIR=0"
    
  operations:
    write: "WXPIN writes the long and raises IN"
    read: "RDPIN/RQPIN can read the long"
    
  during_active:
    wxpin_effect: "Updates the long and raises IN"
    
  during_reset:
    wxpin_effect: "WXPIN instructions are ignored"
    in_signal: "IN is low"

# DAC Noise Mode  
dac_noise_mode:
  condition: "M[12:10] = %101"
  description: "Overrides M[7:0] to feed 8-bit DAC pseudo-random data"
  
  requirements:
    pin_config: "M[12:10] must be set to %101 to configure low-level pin for DAC output"
    data_pattern: "Each pin receives a unique pseudo-random data pattern"
    
  timing:
    update_rate: "Pseudo-random data fed on every clock"
    
  sample_period:
    x_register: "X[15:0] can be set to sample period in clock cycles"
    zero_setting: "Set X[15:0] to zero (65,536 clocks) to maximize period and reduce switching power"
    purpose: "For marking time with IN raising at each period completion"
    
  adc_functionality:
    availability: "RDPIN/RQPIN can retrieve 16-bit ADC accumulation from last sample period"
    
  during_reset:
    in_signal: "IN is low"

instructions:
  setup:
    - "WRPIN - Configure mode (%00001) and set M[12:10] appropriately"
    
  long_repository:
    write: "WXPIN - Write long value (raises IN when DIR=1)"
    read: "RDPIN/RQPIN - Read stored long value"
    
  dac_noise:
    configure: "WXPIN - Set sample period in X[15:0]"
    read_adc: "RDPIN/RQPIN - Get 16-bit ADC accumulation"

timing_characteristics:
  dac_update: "Every clock cycle"
  in_signal: "Raises at sample period completion (DAC mode only)"
  
behavior:
  in_signal:
    long_repository: "Raised when WXPIN updates long (DIR=1 only)"
    dac_noise: "Raised at each sample period completion"
    
  acknowledgment:
    triggers: "WRPIN, WXPIN, WYPIN, RDPIN, AKPIN"
    effect: "Causes smart pin to lower IN signal"
    timing: "Takes two clocks for IN to drop before polling again"

reset_behavior:
  during_reset: 
    - "DIR=0"
    - "IN is low" 
    - "WXPIN ignored (long repository mode)"
    - "No data output (DAC mode)"

usage_notes:
  long_repository:
    - "Use for simple data storage between cogs"
    - "32-bit long storage capacity"
    - "IN signal coordinates data updates"
    
  dac_noise:
    - "Provides unique pseudo-random pattern per pin"
    - "Useful for noise generation or dithering"
    - "Can sample ADC to monitor DAC loading"
    - "Minimize sample period changes to reduce power"

power_optimization:
  dac_noise: "Set X[15:0] to zero for maximum period to reduce switching power consumption"

related_modes:
  - "%00002 (Long Repository)"
  - "%00003 (Long Repository)" 
  - "%00010 (DAC 16-bit dither, noise)"
  - "%00011 (DAC 16-bit dither, PWM)"

see_also:
  - "DAC pin configuration requirements"
  - "ADC accumulation reading"
  - "Smart pin acknowledgment protocol"

source:
  document: "Silicon Doc v35"
  section: "Smart Pin Modes"
  page_reference: "part4-smart-pins.txt"
  extraction_date: "2025-09-06"