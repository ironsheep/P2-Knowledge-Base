# Smart Pin Mode %00110 - NCO Frequency
# Source: Silicon Doc v35, part4-smart-pins.txt

mode_id: "%00110"
mode_name: "NCO Frequency"
description: "Numerically Controlled Oscillator that generates frequency output based on phase accumulation"
category: "frequency_generation"
output_override: true

configuration:
  wrpin_format:
    description: "D/# = %AAAA_BBBB_FFF_MMMMMMMMMMMMM_TT_SSSSS_0"
    sssss_value: "%00110"
    out_override: "OUT signal overridden"

timing_control:
  x_register:
    function: "X[15:0] establishes base period in clock cycles"
    purpose: "Forms empirical high-time and low-time units"
    phase_init: "Upon WXPIN, X[31:16] is written to Z[31:16] for phase setting"
    
  y_register:
    function: "Y[31:0] frequency control word"
    operation: "Added into Z[31:0] at each base period"
    
  z_register:
    function: "32-bit phase accumulator"
    initialization: "Z[31:16] set from X[31:16] on WXPIN"
    accumulation: "Y[31:0] added each base period"

nco_operation:
  phase_accumulation: "Z = Z + Y every base period"
  output_generation: "Pin output reflects Z[31] (MSB)"
  frequency_control: "Y value determines output frequency"
  
frequency_calculation:
  formula: "f_out = (Y * f_clock) / (base_period * 2^32)"
  where:
    f_out: "Output frequency"
    Y: "Frequency control word"
    f_clock: "System clock frequency"
    base_period: "X[15:0] value"

output_behavior:
  source: "Z[31] drives pin output"
  transitions: "Output changes when Z[31] changes"
  duty_cycle: "Approximately 50% for most Y values"

overflow_behavior:
  condition: "Z[31:0] overflows (wraps)"
  in_signal: "IN is raised whenever Z overflows"
  frequency: "IN pulses at output frequency rate"

instructions:
  setup:
    - "WRPIN - Configure mode (%00110)"
    - "WXPIN - Set base period X[15:0] and initial phase X[31:16]"
    
  operation:
    - "WYPIN - Set frequency control word Y[31:0]"

reset_behavior:
  during_reset:
    dir_state: "DIR=0"
    in_signal: "IN is low"
    output: "Output is low"
    z_register: "Z is set to zero"

behavior:
  acknowledgment:
    triggers: "WRPIN, WXPIN, WYPIN, RDPIN, AKPIN"
    effect: "Lowers IN signal after 2 clocks"

usage_notes:
  - "Provides precise frequency generation"
  - "32-bit phase accumulator gives high resolution"
  - "Base period allows frequency scaling"
  - "Initial phase can be set via X[31:16]"
  - "IN signal marks each output cycle completion"

applications:
  frequency_synthesis: "Generate precise frequencies for communication"
  clock_generation: "Programmable clock sources"
  audio_synthesis: "Musical tone generation"
  test_equipment: "Frequency reference generation"

frequency_examples:
  audio_tone:
    setup: "Base period = 1000 (for 1kHz steps)"
    calculation: "Y = (desired_freq * 1000 * 2^32) / f_clock"
    
  clock_division:
    setup: "Base period = 1" 
    calculation: "Y = 2^31 for f_clock/2 output"

comparison_with_duty_mode:
  frequency_mode: "Output reflects phase accumulator MSB Z[31]"
  duty_mode: "Output reflects phase accumulator overflow"
  duty_cycle: "Frequency mode ~50%, duty mode programmable"

related_modes:
  - "%00111 (NCO duty)"
  - "%01000 (PWM triangle)"
  - "%01001 (PWM sawtooth)"

see_also:
  - "NCO frequency calculation methods"
  - "Phase accumulator theory"
  - "Digital frequency synthesis"

source:
  document: "Silicon Doc v35"
  section: "Smart Pin Modes"
  page_reference: "part4-smart-pins.txt"
  extraction_date: "2025-09-06"