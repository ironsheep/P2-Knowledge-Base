# Smart Pin Mode: %00101 - Transition Output
# Silicon Doc Reference: part4-smart-pins.txt, page 87
# Layer 1: Direct Silicon Doc extraction

mode_id: "%00101"

mode_name: "Transition Output"

mode_group: "signal_gen"

mode_complexity: "intermediate"

dac_mode_dependency: false

pin_pairing: "none"

wrpin_configuration:
  base_format: "%AAAA_BBBB_FFF_MMMMMMMMMMMMM_TT_SSSSS_0"
  
  a_input_selector:
    description: "4-bit A input selector - not used for output mode"
    bit_pattern: "%AAAA"
    options:
      - code: "%0000"
        description: "this pin's read state (default, not used)"
        polarity: "true"
        source: "pin_read"
      - code: "%0001"
        description: "relative +1 pin's read state"
        polarity: "true"
        source: "relative_pin"
      - code: "%0010"
        description: "relative +2 pin's read state"
        polarity: "true"
        source: "relative_pin"
      - code: "%0011"
        description: "relative +3 pin's read state"
        polarity: "true"
        source: "relative_pin"
      - code: "%0100"
        description: "this pin's OUT bit from cogs"
        polarity: "true"
        source: "out_bit"
      - code: "%0101"
        description: "relative -3 pin's read state"
        polarity: "true"
        source: "relative_pin"
      - code: "%0110"
        description: "relative -2 pin's read state"
        polarity: "true"
        source: "relative_pin"
      - code: "%0111"
        description: "relative -1 pin's read state"
        polarity: "true"
        source: "relative_pin"
      - code: "%1xxx"
        description: "inverted versions of above"
        polarity: "inverted"
        source: "any"
  
  b_input_selector:
    description: "4-bit B input selector - not used for output mode"
    bit_pattern: "%BBBB"
    options:
      - code: "%0000"
        description: "this pin's read state (default, not used)"
        polarity: "true"
        source: "pin_read"
      - code: "%0001"
        description: "relative +1 pin's read state"
        polarity: "true"
        source: "relative_pin"
      - code: "%0010"
        description: "relative +2 pin's read state"
        polarity: "true"
        source: "relative_pin"
      - code: "%0011"
        description: "relative +3 pin's read state"
        polarity: "true"
        source: "relative_pin"
      - code: "%0100"
        description: "this pin's OUT bit from cogs"
        polarity: "true"
        source: "out_bit"
      - code: "%0101"
        description: "relative -3 pin's read state"
        polarity: "true"
        source: "relative_pin"
      - code: "%0110"
        description: "relative -2 pin's read state"
        polarity: "true"
        source: "relative_pin"
      - code: "%0111"
        description: "relative -1 pin's read state"
        polarity: "true"
        source: "relative_pin"
      - code: "%1xxx"
        description: "inverted versions of above"
        polarity: "inverted"
        source: "any"
  
  input_logic_filtering:
    description: "3-bit input logic/filtering - not used for output mode"
    bit_pattern: "%FFF"
    options:
      - code: "%000"
        description: "A, B (default)"
        operation: "passthrough"
        filter_type: "none"
      - code: "%001"
        description: "A AND B, B"
        operation: "logical_and"
        filter_type: "none"
      - code: "%010"
        description: "A OR B, B"
        operation: "logical_or"
        filter_type: "none"
      - code: "%011"
        description: "A XOR B, B"
        operation: "logical_xor"
        filter_type: "none"
      - code: "%100"
        description: "A, B, both filtered using global filt0"
        operation: "passthrough"
        filter_type: "filt0"
      - code: "%101"
        description: "A, B, both filtered using global filt1"
        operation: "passthrough"
        filter_type: "filt1"
      - code: "%110"
        description: "A, B, both filtered using global filt2"
        operation: "passthrough"
        filter_type: "filt2"
      - code: "%111"
        description: "A, B, both filtered using global filt3"
        operation: "passthrough"
        filter_type: "filt3"
  
  low_level_control:
    description: "13-bit low-level pin control (M[12:0]) - standard output configuration"
    bit_pattern: "%M............"
    special_modes:
      - condition: "M[12:10] = %101"
        behavior: "DAC_MODE - not typically used with transition output"
  
  dir_out_control:
    description: "2-bit pin DIR/OUT control - OVERRIDDEN by smart pin"
    bit_pattern: "%TT"
    smart_off_behavior:
      non_dac_mode: []
      dac_mode: []
    smart_on_behavior:
      dac_modes: []
      non_dac_modes:
        - mode_range: "%00101 (transition output)"
          behavior: "Smart pin overrides OUT signal to control pin transitions"

x_parameter:
  usage: "Base period for transition timing"
  bit_fields:
    - range: "X[15:0]"
      purpose: "Base period in clock cycles between transitions"
      valid_values:
        min: 1
        max: 65535
        special_values:
          - value: 100
            meaning: "100-clock intervals between transitions"
          - value: 1000
            meaning: "1000-clock intervals for slower transitions"
  configuration_timing: "reset_only"

y_parameter:
  usage: "Number of transitions to generate"
  bit_fields:
    - range: "Y[31:0]"
      purpose: "Transition count"
      valid_values:
        min: 0
        max: 4294967295
        special_values:
          - value: 0
            meaning: "No transitions - pin state unchanged"
          - value: 1
            meaning: "Single transition (toggle once)"
          - value: 10
            meaning: "10 transitions (5 complete cycles if starting low)"
  update_behavior: "Writing non-zero value starts transition sequence at next base period"

z_result:
  data_type: "Not used - no result data returned"
  bit_interpretation: []
  flag_behavior: "C flag may contain status information"
  overflow_handling: "Not applicable"

operation_description: |
  Transition output mode overrides OUT to control the pin output state by generating a specific
  number of transitions. X[15:0] establishes a base period in clock cycles which determines the
  timing between transitions. When Y[31:0] is written with a non-zero value, the pin begins
  toggling for Y transitions at each base period, starting at the next base period. Each transition
  alternates the pin state from its current level. IN is raised when the transitions complete,
  with the pin remaining in its current output state (the final state after all transitions).
  During reset (DIR=0), IN is low, output is low, and Y is set to zero.

timing_specifications:
  clock_relationship: "Base period counter operates on system clock"
  base_period:
    description: "Set by X[15:0] - interval between transitions"
    min_clocks: 1
    max_clocks: 65535
    special_values:
      - value: 50
        meaning: "50-clock intervals for fast transitions"
      - value: 10000
        meaning: "10000-clock intervals for slow transitions"
  update_frequency: "Pin toggles every base period until Y transitions completed"
  settling_time: "Pin state changes within 1 clock of base period expiration"

in_signal_behavior:
  trigger_conditions:
    - "Transition sequence completion (Y transitions generated)"
    - "Pin remains in final state after last transition"
  acknowledgment_method: "rdpin"
  polling_restrictions: "2-clock delay after acknowledgment before IN can be polled again"

reset_behavior:
  dir_low_effects:
    - "IN signal goes low"
    - "Output goes low"
    - "Y is set to zero (stops any transition sequence)"
  dir_transition_effects: "Smart pin ready to generate transitions when Y is written"
  wrpin_zero_effects: "Returns pin to normal mode, clears all smart pin configuration"

common_applications:
  - application: "Clock generation"
    description: "Generate specific number of clock cycles"
    complexity_level: "intermediate"
  - application: "Toggle sequences"
    description: "Create precise toggle patterns for testing"
    complexity_level: "beginner"
  - application: "Burst clock generation"
    description: "Generate clock bursts for synchronization"
    complexity_level: "intermediate"
  - application: "Relay control sequences"
    description: "Generate switching sequences for relays or switches"
    complexity_level: "beginner"

configuration_examples:
  - name: "Generate 10 transitions"
    description: "Create 5 complete square wave cycles"
    wrpin_code: "WRPIN ##%0000_0000_000_0000000000000_01_00101_0, toggle_pin"
    wxpin_code: "WXPIN #200, toggle_pin"
    wypin_code: "WYPIN #10, toggle_pin"
    explanation: "200-clock base period, 10 transitions = 5 complete high/low cycles"
  
  - name: "Single pulse generation"
    description: "Generate a single pulse (2 transitions: low-to-high-to-low)"
    wrpin_code: "WRPIN ##%0000_0000_000_0000000000000_01_00101_0, pulse_pin"
    wxpin_code: "WXPIN #1000, pulse_pin"
    wypin_code: "WYPIN #2, pulse_pin"
    explanation: "Start low, transition high (1000 clocks), then low (1000 clocks)"
  
  - name: "Fast toggle burst"
    description: "Generate rapid toggle sequence"
    wrpin_code: "WRPIN ##%0000_0000_000_0000000000000_01_00101_0, burst_pin"
    wxpin_code: "WXPIN #10, burst_pin"
    wypin_code: "WYPIN #20, burst_pin"
    explanation: "10-clock intervals, 20 transitions = 10 complete fast cycles"

typical_code_patterns:
  - pattern_name: "Clock burst generation"
    pasm2_code: |
      ' Configure transition output for clock bursts
      WRPIN ##%0000000000000_01_00101_0, clock_pin
      WXPIN clock_period, clock_pin             ' Set transition period
      DIRH  clock_pin                           ' Enable smart pin
      
      ' Generate clock burst
      WYPIN burst_count, clock_pin              ' Start burst (even number for complete cycles)
      
      wait_burst_done:
      TESTP clock_pin WC                        ' Check completion
      IF_NC JMP #wait_burst_done                ' Wait for burst to finish
      RDPIN dummy, clock_pin                    ' Acknowledge completion
    explanation: "Generate precise clock bursts with completion detection"
  
  - pattern_name: "Sequential toggle control"
    pasm2_code: |
      ' Setup for sequential toggle operations
      WRPIN ##%0000000000000_01_00101_0, toggle_pin
      WXPIN #500, toggle_pin                    ' 500-clock between toggles
      DIRH  toggle_pin                          ' Enable
      
      sequence_loop:
      WYPIN #1, toggle_pin                      ' Single transition (toggle)
      ' ... do other work for 500+ clocks ...
      TESTP toggle_pin WC                       ' Check if toggle done
      IF_C  RDPIN dummy, toggle_pin             ' Acknowledge
      IF_C  JMP #sequence_loop                  ' Continue sequence
    explanation: "Use single transitions to create controlled toggle sequences"

related_modes:
  - mode_id: "%00100"
    relationship: "complementary"
    description: "Pulse/cycle output - generates pulses instead of transitions"
  - mode_id: "%00110"
    relationship: "advanced_version"
    description: "NCO frequency - continuous frequency generation"
  - mode_id: "%00111"
    relationship: "advanced_version"
    description: "NCO duty - frequency generation with duty cycle control"

related_instructions:
  - instruction: "WRPIN"
    usage_context: "Configure transition output mode"
  - instruction: "WXPIN"
    usage_context: "Set base period between transitions"
  - instruction: "WYPIN"
    usage_context: "Set transition count and start sequence"
  - instruction: "DIRH"
    usage_context: "Enable smart pin operation"
  - instruction: "TESTP"
    usage_context: "Check for sequence completion"
  - instruction: "RDPIN"
    usage_context: "Acknowledge completion (clears IN signal)"

hardware_considerations:
  power_implications: "Power consumption depends on transition frequency and count"
  pin_loading_effects: "Standard digital output loading - fast transitions require good signal integrity"
  noise_considerations: "Fast transitions can generate EMI - consider slew rate and filtering"
  thermal_effects: "High-frequency transitions can cause heating in output drivers"

extraction_metadata:
  extraction_date: "2025-09-06"
  source_documents:
    - document: "Silicon Doc part4-smart-pins.txt"
      pages: [87]
      section: "%00101 = transition output"
  validation_status: "draft"
  completeness_score: 93
  technical_accuracy: "silicon_doc_verified"