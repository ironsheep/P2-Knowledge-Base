# Smart Pin Mode: %10000 - Time A-States
# Silicon Doc Reference: part4-smart-pins.txt, page 92
# Layer 1: Direct Silicon Doc extraction

mode_id: "%10000"

mode_name: "Time A-States"

mode_group: "measurement"

mode_complexity: "intermediate"

dac_mode_dependency: false

pin_pairing: "none"

operation_description: |
  Time A-states mode measures the duration of continuous states (both high and low) on the A input.
  Upon each state change, the prior state duration count is placed in Z, the prior state is placed
  in the C-flag buffer, and IN is raised. Z is limited to $80000000. If states change faster than
  the cog can retrieve measurements, old measurements are overwritten. Can use two pins with inverted
  A inputs to capture both high and low states reliably.

x_parameter:
  usage: "Not used in this timing mode"

y_parameter:  
  usage: "Not used in this timing mode"

z_result:
  data_type: "32-bit state duration in clock cycles"
  bit_interpretation:
    - range: "Z[31:0]"
      meaning: "Duration of previous state in clock cycles (limited to $80000000)"
  flag_behavior: "C flag contains previous state (high/low)"
  overflow_handling: "Limited to $80000000 maximum count"

timing_specifications:
  clock_relationship: "Continuous state timing, asynchronous to state changes"
  update_frequency: "Result available on each state transition"

in_signal_behavior:
  trigger_conditions:
    - "A input state change (high-to-low or low-to-high)"
  acknowledgment_method: "rdpin"


initialization_requirement:
  critical: true
  description: "Smart pin MUST be reset before configuration"
  requirement: |
    The smart pin MUST be reset (DIR=0) before any configuration or reconfiguration.
    This ensures the smart pin is in a known state and prevents configuration conflicts.
  reset_sequence:
    pasm2: |
      DIRL  pin         ' REQUIRED: Reset smart pin (DIR=0)
      WRPIN mode, pin   ' Configure mode
      WXPIN x, pin      ' Set X parameter
      WYPIN y, pin      ' Set Y parameter
      DIRH  pin         ' Enable smart pin (DIR=1)
    spin2: |
      PINCLEAR(pin)              ' Reset pin (DIR=0, WRPIN=0)
      PINSTART(pin, mode, x, y)  ' Configure and enable
      ' OR manually:
      PINFLOAT(pin)              ' Ensure DIR=0
      WRPIN(pin, mode)           ' Set mode
      WXPIN(pin, x)              ' Set X parameter
      WYPIN(pin, y)              ' Set Y parameter
      PINHIGH(pin)               ' Enable (DIR=1)

reset_behavior:
  dir_low_effects:
    - "IN signal goes low"
    - "Z is set to $00000001"
  dir_transition_effects: "Begin timing A input states"
  wrpin_zero_effects: "Return to normal mode"
  reset_requirement: "ALWAYS set DIR=0 before reconfiguring the smart pin"

common_applications:
  - application: "Pulse width measurement"
    description: "Measure both high and low pulse durations"
    complexity_level: "intermediate"
  - application: "Duty cycle analysis"
    description: "Measure high/low ratios of signals"
    complexity_level: "intermediate"

configuration_examples:
  - name: "Pulse width measurement"
    description: "Measure both high and low pulse widths"
    reset_code: "DIRL pulse_timer                  ' REQUIRED: Reset before configuration"
    wrpin_code: "WRPIN ##%0000_0000_101_0000000000000_00_10000_0, pulse_timer"
    wxpin_code: "WXPIN #0, pulse_timer"
    explanation: "A input filtered with filt1, measure all state durations"

typical_code_patterns:
  - pattern_name: "Dual-pin state measurement"
    pasm2_code: |
      ' Configure two pins for complete state capture
      WRPIN ##%0000_0000_000_0000000000000_00_10000_0, state_pin_normal
      WRPIN ##%1000_0000_000_0000000000000_00_10000_0, state_pin_inverted
      DIRH  state_pin_normal
      DIRH  state_pin_inverted
      
      measure_loop:
      TESTP state_pin_normal WC
      IF_C  RDPIN high_time, state_pin_normal
      TESTP state_pin_inverted WC  
      IF_C  RDPIN low_time, state_pin_inverted
      JMP   #measure_loop
    explanation: "Use two pins with inverted A inputs to capture all state changes"

extraction_metadata:
  extraction_date: "2025-09-06"
  source_documents:
    - document: "Silicon Doc part4-smart-pins.txt"
      pages: [92]
      section: "%10000 = time A-states"
  validation_status: "draft"
  completeness_score: 88
  technical_accuracy: "silicon_doc_verified"