# Image Extraction Work Mode Guide

**Single Purpose**: Complete image extraction from ingested documents - selection, extraction, failure analysis, and asset integration

**This document provides**: 
1. **Extraction Pipeline Matrix** ‚Üí generates ‚Üí **MCP Tasks** ‚Üí enables ‚Üí **Systematic Extraction** ‚Üí results in ‚Üí **Visual Asset Library**

## üö® SESSION START INTEGRATION

### Work Mode Identification
**Trigger Phrases**: "image extraction", "extract images", "visual assets", "PDF image processing"
**Confirmation**: "This covers complete image extraction from PDF documents to organized visual asset library"

### Todo MCP Integration  
**CRITICAL - Always use this filter:**
```bash
mcp__todo-mcp__todo_next tags:["image_extraction"]
```

**Why This Matters:**
- ‚úÖ **Focuses on extraction-specific tasks** 
- ‚úÖ **Prevents mixing extraction with ingestion** 
- ‚úÖ **Ensures systematic progression** from PDF to organized visual assets

### üéØ **CRITICAL TAGGING RULE**
**ALL tasks generated by this workflow MUST use the tag: `["image_extraction"]`**

**This ensures**:
- `mcp__todo-mcp__todo_next tags:["image_extraction"]` returns ONLY your extraction tasks
- No interference from other work mode tasks
- Clean, focused execution environment
- Proper task sequencing within extraction workflow

---

## üîÑ IMAGE EXTRACTION WORKFLOW
*Follow this exact sequence for optimal results*

### PHASE 1: EXTRACTION SELECTION & SETUP

#### Step 1: Review Extraction Pipeline Matrix
```bash
# Check current extraction opportunities
mcp__filesystem__read_text_file path:"/sources/visual-assets/INGESTION-IMAGE-EXTRACTION-MATRIX.md"
```

**Present User with Selection Menu:**
```markdown
## üéØ Available Image Extractions

### üî¥ **CRITICAL Priority** (Immediate Value)
1. **P2 Silicon Documentation v35** - Expected: 20-30 images (architecture diagrams, chip photos, pinouts)
2. **P2 Hardware Manual** - Expected: 15-25 images (board layouts, connectors, mechanical specs)  
3. **Smart Pins Documentation rev 5** - Expected: 25-35 images (pin mode diagrams, timing charts)

### üü° **HIGH Priority** (Significant Value)
4. **PASM2 Language Manual** - Expected: 30-40 images (instruction diagrams, timing charts)
5. **Spin2 Documentation v51** - Expected: 20-30 images (IDE screenshots, syntax diagrams)
6. **P2 Eval Board Rev C Guide** - Expected: 8-12 images (board photos, pin diagrams)

### üü¢ **MEDIUM Priority** (Additional Value)
7. **P2 Eval Add-on Boards Product Guide** - Expected: 12-16 images (board photos, schematics)
8. **Universal Motor Driver P2 Add-on Board** - Expected: 8-12 images (wiring diagrams, PCB photos)

**Which extraction would you like to process?** (This will guide directory setup and extraction parameters)
```

#### Step 2: Locate Source PDF and Setup Extraction Directory
**ALWAYS EXTRACT FROM**: `/sources/originals/[filename]`
- Verify source PDF exists and is accessible
- ‚ö†Ô∏è **TEMPORARY**: Initial extraction creates `extracted_images_[document-identifier]/` in root directory
- ‚úÖ **FINAL LOCATION**: All extracted images MUST be moved to proper ingestion tree structure:
  ```
  sources/extractions/[document-extraction-audit]/assets/images-YYYYMMDD/
  ```
- **Directory Structure Examples**:
  - Smart Pins: `sources/extractions/smart-pins-complete-extraction-audit/assets/images-20250824/`
  - Spin2 v51: `sources/extractions/spin2-v51-complete-extraction-audit/assets/images-20250828/`
  - P2 Edge Standard: `sources/extractions/edge-standard-module-complete-extraction-audit/assets/images-20250824/`
- Check PDF size and pages for extraction planning
- Note: Extraction outputs both PNG files and JSON catalog

#### Step 3: Enhanced Extraction Tool Preparation
**üö® NEW v3.0: Coordinate-Aware Rescue System**

**Primary Tools** (in `/engineering/tools/extraction/`):
- ‚úÖ **enhanced_pdf_extractor.py** - Coordinate-aware extraction with bbox capture
- ‚úÖ **simple_black_detector.py** - Quality analysis and failed extraction detection
- ‚úÖ **replace_with_cropped.py** - Replace full-page images with rescued crops
- ‚úÖ **update_catalog_numbering.py** - Apply sequential numbering system

**Enhanced Capabilities v3.0:**
- ‚úÖ **Coordinate capture** - Saves bounding boxes for rescue operations
- ‚úÖ **Black image detection** - Brightness analysis (threshold <10)
- ‚úÖ **Coordinate-aware rescue** - pdf2image + cropping using saved coordinates
- ‚úÖ **Sequential numbering** - [PREFIX]-001 format for easy reference
- ‚úÖ **Quality assurance** - Automated detection and replacement of failed extractions
- ‚úÖ **Browser cache handling** - Documentation for image display issues

**Required Dependencies** (should be available):
- PyMuPDF (`fitz`), pdf2image, PIL/Pillow

---

### PHASE 2: IMAGE EXTRACTION EXECUTION

#### Step 4: Execute Enhanced Coordinate-Aware Extraction
**üîÑ v3.0 Enhanced Pipeline**:

**Phase 1: Initial Extraction with Coordinate Capture**
```bash
cd /Users/stephen/Projects/Projects-ExtGit/IronSheepProductionsLLC/Propeller2/P2-Language-Study/P2-Knowledge-Base

# Step 1: Enhanced extraction with bounding box coordinates
python3 engineering/tools/extraction/enhanced_pdf_extractor.py "sources/[filename].pdf" -o "extracted_images_[doc-id]"
```

**Phase 2: Quality Analysis & Black Image Detection**
```bash
# Step 2: Analyze all extracted images for quality issues
python3 engineering/tools/extraction/simple_black_detector.py "extracted_images_[doc-id]/"
```

**Phase 3: Coordinate-Aware Rescue System**
```bash
# Step 3: Apply rescue system to failed extractions (if any detected)
python3 engineering/tools/extraction/replace_with_cropped.py "extracted_images_[doc-id]/" "sources/[filename].pdf"
```

**Phase 4: Sequential Numbering Application**
```bash
# Step 4: Apply sequential numbering system (e.g., P2DS-001, P2SD-001)
python3 engineering/tools/extraction/update_catalog_numbering.py "extracted_images_[doc-id]/catalog.md" "[OLD-PREFIX]" "[DOC-PREFIX]"
```

**Monitor v3.0 Pipeline Output For**:
- **‚úÖ Coordinate capture** - Bounding boxes saved for rescue
- **üîç Quality analysis** - Brightness scores and file size validation  
- **üõ°Ô∏è Rescue operations** - Coordinate-aware cropping of failed extractions
- **üìù Sequential numbering** - [PREFIX]-001 through [PREFIX]-N assignment
- **‚ö†Ô∏è Browser cache warnings** - Instructions for image display refresh

#### Step 5: Multi-Part PDF Handling (When Required)
**SPECIAL CASE**: For PDFs split into multiple parts due to size constraints

**When to Use Multi-Part Extraction**:
- Large PDFs split into: `Document-Part1of5.pdf`, `Document-Part2of5.pdf`, etc.
- File size constraints prevented single-document processing
- Original PDF was divided for ingestion workflow compatibility

**Multi-Part Extraction Workflow**:

1. **Extract Each Part with v3.0 Enhanced Pipeline**:
```bash
# Extract each part using coordinate-aware extraction
python3 engineering/tools/extraction/enhanced_pdf_extractor.py "sources/Document-Part1of5.pdf" -o "extracted_images_[doc]_part1"
python3 engineering/tools/extraction/enhanced_pdf_extractor.py "sources/Document-Part2of5.pdf" -o "extracted_images_[doc]_part2"
# Continue for all parts...

# Apply quality analysis and rescue to each part
for part in part1 part2 part3 part4 part5; do
  python3 engineering/tools/extraction/simple_black_detector.py "extracted_images_[doc]_${part}/"
  python3 engineering/tools/extraction/replace_with_cropped.py "extracted_images_[doc]_${part}/" "sources/Document-${part^}of5.pdf"
done
```

2. **Create Unified Directory Structure**:
```bash
# Create final unified directory
mcp__filesystem__create_directory path:"sources/extractions/[document-audit]/assets/images-[YYYYMMDD]"
```

3. **Combine Images with Collision Protection** ‚ö†Ô∏è **CRITICAL SAFETY PROTOCOL**:
```bash
# MANDATORY: Check for filename collisions before copying
for part in 1 2 3 4 5; do
  for file in extracted_images_[document]_part${part}/*.png; do
    if [ -f "$file" ]; then
      basename=$(basename "$file")
      destination="sources/extractions/[document-audit]/assets/images-[YYYYMMDD]/$basename"
      
      # Check for collision
      if [ -f "$destination" ]; then
        # Collision detected - rename with part identifier
        new_name="${basename%.png}_part${part}.png"
        new_destination="sources/extractions/[document-audit]/assets/images-[YYYYMMDD]/$new_name"
        cp "$file" "$new_destination"
        echo "‚ö†Ô∏è COLLISION AVOIDED: $basename ‚Üí $new_name (from Part $part)"
      else
        # No collision - copy normally
        cp "$file" "$destination"
      fi
    fi
  done
done
```

4. **Copy JSON Catalogs for Merging**:
```bash
# Copy all part catalogs to unified directory
cp extracted_images_[document]_part*/*.json sources/extractions/[document-audit]/assets/images-[YYYYMMDD]/
```

5. **Create Comprehensive Multi-Part Catalog**:
   - **Part-by-part breakdown** in Markdown catalog
   - **Content distribution analysis** (which parts contained major content)
   - **Cross-part validation** (ensure no missing page ranges)
   - **Document any collision resolutions** with renamed files

6. **Verify Combination Success**:
```bash
# Verify total image count matches expectation
expected_total=34  # Sum from all parts
actual_count=$(ls sources/extractions/[document-audit]/assets/images-[YYYYMMDD]/*.png | wc -l)
echo "Expected: $expected_total, Actual: $actual_count"
# Proceed with cleanup only if counts match
```

7. **Clean Up Temporary Directories** (Only After Verification):
```bash
# Remove temporary directories only after successful verification
rm -rf extracted_images_[document]_part1 extracted_images_[document]_part2 extracted_images_[document]_part3 extracted_images_[document]_part4 extracted_images_[document]_part5
```

**Multi-Part TodoWrite Progress Tracking**:
- Update progress with part-specific status: "Extracting Part 3 of 5"
- Track collision resolutions in context for catalog documentation
- Store part-level statistics for debugging and comprehensive reporting

**Why File Collision Protection Matters**:
- **Data Integrity**: Prevents accidental overwrites during combination
- **Complete Preservation**: Every extracted image retained, even with naming conflicts
- **Audit Trail**: Modified names show which part each image originated from
- **Recovery Insurance**: Since temp directories are deleted after, this is the only protection against silent data loss

#### Step 6: Move Images to Proper Directory Structure (Single PDF)
**STANDARD CASE**: After single-PDF extraction completes, immediately move images to proper ingestion tree location:

```bash
# Create proper directory structure if it doesn't exist
mcp__filesystem__create_directory path:"sources/extractions/[document-extraction-audit]/assets/images-[YYYYMMDD]"

# Move all extracted files from temporary location to proper structure
# Example for Spin2 v51:
mv extracted_images_spin2_v51/* sources/extractions/spin2-v51-complete-extraction-audit/assets/images-20250828/
rmdir extracted_images_spin2_v51
```

**Directory Naming Convention**:
- **Document Audit Directory**: `[document-name]-complete-extraction-audit/`
- **Assets Directory**: `assets/images-[YYYYMMDD]/` (use extraction date)
- **Complete Path**: `sources/extractions/[document-audit]/assets/images-[YYYYMMDD]/`

#### Step 6: Analyze Extraction Results
**Success Metrics**:
```bash
# Check extraction statistics from terminal output
# Review JSON catalog for metadata completeness
mcp__filesystem__read_text_file path:"sources/extractions/[document-audit]/assets/images-[YYYYMMDD]/[document-name]_image_catalog.json"
```

**Key Analysis Points**:
- **Success rate** (target: >90% for most documents)
- **Failed extractions** (specific xref patterns to identify)
- **Context quality** (caption detection accuracy)
- **Image dimensions** (high-resolution vs standard)
- **Content classification** (technical diagrams vs marketing photos)

---

### PHASE 3: FAILURE ANALYSIS & INTERVENTION

#### Step 7: Enhanced Failure Analysis with v3.0 Quality Detection
**üö® v3.0 Automated Detection**:
- **Black image detection** using brightness analysis (threshold <10)
- **File size validation** (suspicious images <5KB)
- **Coordinate capture success** verification

**v3.0 Quality Analysis Output**:
```bash
# Automated quality analysis from simple_black_detector.py:
"üîç Quality Analysis Results:"
"  ‚úÖ High quality: [N] images (brightness >50, size >10KB)"
"  ‚ö†Ô∏è  Suspicious: [N] images (brightness <50 or size <10KB)"
"  ‚ùå Failed: [N] images (brightness <10, likely black)"
"  üìä Overall success rate: [XX.X%]"

# Coordinate-aware rescue results:
"üõ°Ô∏è Rescue Operations:"
"  üéØ [N] failed images identified with coordinates"
"  ‚úÖ [N] successfully rescued using coordinate cropping"
"  üìè Final images show actual cropped dimensions (not full-page)"
```

**Legacy Failure Patterns Still Monitored**:
- **xref coordinate issues** - Now automatically rescued with coordinate-aware system
- **PyMuPDF placeholders** - Detected via brightness analysis and replaced
- **Full-page captures** - Identified by dimension analysis and replaced with crops

#### Step 8: Human Intervention Assessment  
**For Each Failed Extraction:**

**IF Rescue Successful**: ‚úÖ No action needed
**IF Rescue Failed**: ‚ö†Ô∏è Manual capture required

**Manual Capture Requirements**:
```markdown
### Failed Extractions Report - [Document Name]

| Page | Position | Expected Content | Issue | Manual Capture Priority |
|------|----------|------------------|-------|----------------------|
| Page X | Image Y | [Context from JSON] | xref ## coordinate issue | ‚úÖ High/Medium/Low |
```

**Priority Guidelines**:
- **High Priority**: Technical diagrams, pinouts, essential schematics
- **Medium Priority**: Board photos, connector details  
- **Low Priority**: Marketing images, decorative elements

#### Step 9: Document Intervention Requirements
**Create Manual Capture Guide**:
- List exact pages and positions needing manual screenshot
- Include context descriptions from JSON catalog
- Specify required image names for consistency
- Note integration requirements for failed assets

---

### PHASE 4: ASSET ORGANIZATION & CATALOGING

#### Step 10: Create Enhanced Catalogs with Sequential Numbering
**üö® v3.0 Enhancement**: Integrated sequential numbering system

**Required Outputs**:
1. **JSON Catalog**: `[document-name]_image_catalog.json` (automated by enhanced_pdf_extractor.py)
2. **Markdown Catalog**: `image-catalog.md` (automated with sequential numbering)
3. **Sequential numbering**: Applied using `update_catalog_numbering.py`

**v3.0 Sequential Numbering Examples**:
- **P2DS-001** through **P2DS-039**: P2 **D**ata**S**heet images
- **P2SD-001** through **P2SD-N**: P2 **S**ilicon **D**oc images
- **P2SP-001** through **P2SP-N**: P2 **S**mart **P**ins images

**Extend Existing Catalog**: `/sources/visual-assets/P2-Edge-Master-Image-Catalog.md`
**OR Create New Catalog**: `/sources/visual-assets/[Document-Family]-Master-Image-Catalog.md`

**v3.0 Enhanced Markdown Catalog Structure**:
```markdown
# [Document Name] - Enhanced Visual Asset Catalog v3.0
**Coordinate-Aware Extraction with Sequential Numbering**

**Extraction Date**: YYYY-MM-DD  
**Enhancement**: v3.0 coordinate-aware rescue system applied  
**Total Images**: XX successfully extracted (XX original + XX rescued)  
**Success Rate**: 100% (XX/XX after coordinate-aware rescue)  
**Sequential Range**: [PREFIX]-001 through [PREFIX]-XXX  
**Quality Assurance**: All images brightness >50, actual cropped dimensions  

---

## üìã **Complete Image Inventory with Sequential IDs**

### **[PREFIX]-001** | Page XX - [Section Name] ‚≠ê **CROPPED**  
**File**: `[filename].png`  
**Dimensions**: XXX√óXXX pixels (actual cropped size)  
**Size**: XX.XKB | **Quality**: Brightness XX (excellent)  
**Context**: [caption/nearby text]  
**Content Type**: [technical diagram/schematic/photo]  
**Usage**: Easy reference "Please update [PREFIX]-001 description"  
![PREFIX-001: Description]([filename].png)

### **[PREFIX]-002** | Page XX - [Section Name]  
[Same enhanced format for all images...]

---

## üìä **v3.0 Quality Analysis**
**Rescued Images**: [count] - Originally black/full-page, now properly cropped  
**Brightness Distribution**: [count] >80 (excellent), [count] 50-80 (good), [count] <50 (acceptable)  
**File Size Distribution**: [count] >50KB (detailed), [count] 10-50KB (standard), [count] <10KB (simple)  
**Dimension Analysis**: All show actual content dimensions (no full-page 1700√ó2200)  

## üîÑ **Browser Cache Advisory**
**Important**: After extraction updates, refresh browser cache (Ctrl+F5) to see actual cropped images instead of cached full-page versions.
```

**Master Catalog Structure** (Project-level aggregation):

---

## üìä **Quick Stats by Document**
| Document | Images | Success | High-Res | Technical | Marketing |
|----------|--------|---------|----------|-----------|-----------|
| **[Doc Name]** | X/Y | XX.X% | # | # | # |

## üîç **Search by Content Type**
### üì∑ **Product Hero Shots & Beauty Images**
### üîß **Technical Diagrams & Schematics**  
### ‚ö†Ô∏è **Safety & Warning Graphics**

## üè∑Ô∏è **Search by Technical Tags**
### By Hardware Type / By Use Case / By Content Category

## ‚ùå **Failed Extractions Report**
[If any manual intervention needed]
```

#### Step 11: Update Extraction Matrix Status
**Update**: `/sources/visual-assets/INGESTION-IMAGE-EXTRACTION-MATRIX.md`

**Status Changes**:
- **From**: `‚ùå **PENDING**` 
- **To**: `‚úÖ **COMPLETE**` with success statistics

**Add Completion Metrics**:
```markdown
| **[Document Name]** | PDF | ‚úÖ COMPLETE | ‚úÖ **COMPLETE** | XX images | XX.X% |
```

**Update Summary Statistics**:
- Increment completed documents count
- Update total images extracted
- Recalculate overall success rates

---

### PHASE 5: QUALITY VALIDATION & ASSESSMENT

#### Step 12: Completeness Validation
**CRITICAL**: Ensure extraction meets requirements and consumer needs

**Extraction Completeness Checklist**:
- [ ] **All expected images extracted** (compare against matrix estimate)
- [ ] **Failed extractions documented** with manual intervention plan
- [ ] **Context quality verified** (captions and surrounding text captured)
- [ ] **Content classification complete** (technical vs marketing vs safety)
- [ ] **Consumer needs assessed** (which extractions/documents can use these assets)

**Quality Validation Framework**:
```markdown
## Image Extraction Quality Assessment - [Document Name]

### Coverage Analysis
**Expected Images**: [N] (from extraction matrix estimate)
**Successfully Extracted**: [N] images ([XX.X%] success rate)
**Failed Extractions**: [N] images requiring manual intervention
**Bonus Content**: [N] additional valuable images identified

### Content Quality Analysis  
**High-Value Technical**: [N] images (diagrams, schematics, pinouts)
**Standard Reference**: [N] images (board photos, product shots)
**Safety/Warning**: [N] images (caution graphics, orientation guides)
**Context Quality**: [XX%] images with usable caption text extracted

### Extraction Completeness Assessment
**Status**: ‚úÖ COMPLETE / ‚ö†Ô∏è REQUIRES HUMAN INTERVENTION / ‚ùå INCOMPLETE
**Manual Intervention Required**: [Yes/No] - [N] images need manual capture
**Intervention Priority**: [High/Medium/Low] based on technical content importance
**Integration Ready**: ‚úÖ YES / ‚ùå NO - [blocking issues if any]
```

#### Step 13: Consumer Impact Planning
**Consumer Coverage Validation**:
- [ ] **Primary extraction updated** with "VISUAL ASSETS EXTRACTED" section
- [ ] **All secondary extractions identified** and reference files created
- [ ] **Document enhancement opportunities cataloged** in technical debt
- [ ] **Asset distribution complete** (no consumer left without visibility)
- [ ] **Bonus images distributed** to relevant contexts automatically

**Consumer Impact Analysis**:
```markdown
### Consumer Impact Analysis
**Secondary Extractions Enhanced**: [N] specialized extractions gain new assets
**Document Enhancement Opportunities**: [N] manuals/guides can be improved
**Immediate Integration Value**: [High/Medium/Low] based on consumer priority
**Technical Debt Generated**: [N] document enhancement tasks queued
```

### PHASE 6: CONSUMER DISTRIBUTION & PLANNING

#### Step 14: Asset Distribution Planning
**Goal**: Ensure all consumers know about and can access new visual assets

**Primary vs Secondary Asset Model**:
- **Primary Extraction**: Owns the physical image files and master catalog
- **Secondary Extractions**: Reference the primary assets with context-specific usage
- **Documents**: Queue enhancement opportunities in technical debt system

**Consumer Identification Process**:
1. **Review related extractions** - which other extractions could use these images?
2. **Identify document opportunities** - which manuals/guides could be enhanced?
3. **Assess relevance and value** - prioritize high-impact consumer relationships
4. **Create distribution plan** - immediate updates vs strategic enhancements

#### Step 15: Execute Consumer Updates
**Tier 1: Immediate Updates (Secondary Extractions)**

For each identified secondary extraction:
1. **Create reference file**: `assets/images-[YYYYMMDD].md`
2. **Include relevant image subset**: Only images applicable to that extraction's focus
3. **Add contextual usage descriptions**: How these images serve that extraction's purpose
4. **Link back to primary**: Always point to primary extraction for complete details
5. **Include bonus images**: Automatically include relevant supplementary content

**Tier 2: Deferred Updates (Document Enhancements)**

For each identified document enhancement opportunity:
1. **Assess enhancement value**: How much would these images improve the document?
2. **Estimate integration effort**: Time required to properly integrate assets
3. **Queue in technical debt**: Add to `/technical-debt/VISUAL-ASSETS-DEBT.md`
4. **Aggregate with existing**: Combine with any previously available assets
5. **Mark for sprint selection**: Ready for strategic planning and prioritization

#### Step 16: Schedule Follow-up Actions
**IF Manual Capture Needed**:
```bash
# Create follow-up task for manual screenshot work
mcp__todo-mcp__todo_create content:"Manual capture of [N] failed extractions from [document-name] - specific pages and positions documented" priority:"medium" estimate_minutes:[N*5] tags:["manual_capture", "image_extraction"]
```

**IF Consumer Updates Needed**:
```bash  
# Update secondary extractions (immediate)
mcp__todo-mcp__todo_create content:"Update [N] secondary extraction reference files with new [document-name] visual assets" priority:"high" estimate_minutes:[N*10] tags:["consumer_updates", "image_extraction"]

# Queue document enhancements (deferred)
mcp__todo-mcp__todo_create content:"Add [document-name] visual assets to technical debt queue for [N] document enhancement opportunities" priority:"low" estimate_minutes:15 tags:["technical_debt", "image_extraction"]
```

### PHASE 7: SYSTEM INTEGRATION & UPDATES

#### Step 17: Update All Tracking Systems (MANDATORY)
**CRITICAL**: Maintain data integrity across ALL tracking documents that reference image extraction status

**Required Updates After Every Extraction** (in this order):

1. **Update Operations Dashboard** (`/engineering/README.md`)
   - Update Asset Extraction Status metrics
   - Update success rates and totals
   - Update Work Mode status with extraction completion
   - Update Pipeline Impact section with new capabilities

2. **Update Ingested Sources Catalog** (`/sources/INGESTED-SOURCES-CATALOG.md`)
   - Update Image Extraction column for processed document
   - Change from "PENDING" to "EXTRACTED" with success statistics
   - Update Visual Assets Extraction Status summary section
   - Update Repository Health metrics

3. **Update Document Production Pipeline** (`/pipelines/document-production-pipeline.md`)
   - Update Visual Asset Integration section with new available assets
   - Update Enhancement Opportunities based on new consumer possibilities
   - Update any documents that could benefit from new visual assets

4. **Update Technical Debt Registry** (`/technical-debt/VISUAL-ASSETS-DEBT.md`)
   - Add new enhancement opportunities for documents that can use the extracted images
   - Update effort estimates based on newly available assets
   - Update enhancement value calculations
   - Add specific consumer registry entries

5. **Update Project Master** (`/engineering/operations/README.md`) 
   - Update methodology improvements section if new patterns discovered
   - Update knowledge coverage metrics
   - Update asset extraction pipeline status

**Why This Matters**:
- Prevents data inconsistency across tracking systems
- Ensures extraction work is visible in all relevant contexts
- Maintains accurate project status reporting
- Enables proper sprint planning with current asset availability

#### Step 18: Generate Comprehensive Extraction Report
**REQUIRED**: Always provide complete extraction summary:

```markdown
## Image Extraction Summary - [Document Name]

### üéØ **EXTRACTION COMPLETENESS STATUS**
**Status**: ‚úÖ **COMPLETE - Ready for Integration** / ‚ö†Ô∏è **REQUIRES HUMAN INTERVENTION** / ‚ùå **INCOMPLETE - Technical Issues**

**Completeness Details**:
- **Extraction Complete**: [Yes/No] - All expected images processed by pdf_image_extractor.py
- **Manual Intervention Needed**: [Yes/No] - [N] images require manual capture from failed extractions
- **Integration Ready**: [Yes/No] - All assets organized and ready for consumer distribution
- **Human Action Required**: [None / Manual screenshot of [N] technical diagrams on pages [X,Y,Z] / Review and prioritize [N] failed extractions]

---

### ‚úÖ **Primary Extraction (Completed)**
- **Source**: [filename] ([size], [pages])
- **Tool**: pdf_image_extractor.py
- **Output**: [N] images extracted to `extracted_images_[document-id]/`
- **Success Rate**: [XX.X%] ([successful]/[total] images)
- **Processing Time**: [duration]

### üìä **Extraction Quality Analysis**
**High-Resolution Assets**: [N] images ‚â•800 pixels (technical diagrams, detailed photos)
**Standard Resolution**: [N] images <800 pixels (icons, simple graphics)
**Context Detection**: [N] images with caption text identified
**Technical Content**: [N] images tagged as technical diagrams/schematics
**Marketing Content**: [N] images tagged as product photos/marketing

### ‚ùå **Failed Extractions & Intervention**
**Status**: [‚úÖ All successful / ‚ö†Ô∏è [N] failures requiring manual capture]
**Failure Pattern**: [xref ## coordinate issues / other specific pattern]
**Manual Intervention Priority**: [High/Medium/Low based on content]
**Rescue Attempts**: [N] attempted, [N] successful via pdf2image

### üîÑ **Consumer Distribution & Planning**
**Asset Ownership**: Primary extraction [name] owns [N] image assets
**Secondary Extractions Updated**: [N] specialized extractions with new reference files
**Document Enhancement Opportunities**: [N] manuals/guides identified for potential improvement
**Consumer Registry Created**: ‚úÖ ASSET-CONSUMERS.md with complete distribution mapping
**Technical Debt Generated**: [N] document enhancement tasks queued in technical debt system
**Bonus Images Distributed**: [N] additional valuable images automatically forwarded to relevant consumers

### üìÅ **Asset Organization**
**Directory Created**: `extracted_images_[document-id]/`
**Catalog Generated**: `[document-name]_image_catalog.json` with complete metadata
**Master Catalog**: [Updated existing / Created new] at `sources/visual-assets/`
**Search Tags Applied**: [list of primary content classification tags]

### üîÑ **Pipeline Impact**  
**Extraction Matrix Updated**: [Document status changed from PENDING to COMPLETE]
**Expected Utilization**: [Manual creation / Technical reference / Educational materials]
**Integration Opportunities**: [Specific manuals/guides that can use these assets]
**Knowledge Base Value**: [How these assets fill gaps or enhance existing content]

### üìà **Next Actions**
**Immediate**: [Manual capture tasks if needed] + [Consumer reference file updates]
**Strategic**: [Document enhancement opportunities queued in technical debt]  
**Future**: [Multi-session import planning if large document family]
**Consumer Impact**: [N] extractions enhanced, [N] documents ready for strategic improvement
```

---

## üîß EXTRACTION TOOL MASTERY
*Comprehensive guide to pdf_image_extractor.py usage*

### Tool Location & Basic Usage
**Path**: `/tools/pdf_image_extractor.py`
**Dependencies**: PyMuPDF (fitz), pdf2image, PIL

### Command Patterns

#### Standard Extraction
```bash
python3 tools/pdf_image_extractor.py "path/to/document.pdf" -o "output_directory"
```

#### Test Mode (Quick Validation)
```bash  
python3 tools/pdf_image_extractor.py --test
# Uses first P2 Edge PDF found in sources/originals/
```

#### Advanced Parameters
```bash
# Custom output directory
python3 tools/pdf_image_extractor.py "document.pdf" --output "custom_dir_name"

# The tool automatically handles:
# - Size filtering (skips images <50x50 pixels)
# - Format conversion (CMYK to RGB)
# - Context extraction (surrounding text analysis)  
# - Placeholder detection (PyMuPDF warning triangles)
# - Rescue attempts (pdf2image fallback for failures)
```

### Understanding Tool Output

#### Success Indicators
```
‚úÖ Opened PDF: /path/to/document.pdf
üìÑ Pages: 15
üìÑ Page 1: Found 3 images
  ‚úÖ Extracted: document_page01_img01.png (1000√ó800)
  ‚úÖ Extracted: document_page01_img02.png (400√ó300)
```

#### Failure & Rescue Indicators  
```
  ‚ö†Ô∏è  WARNING: Placeholder detected - document_page04_img02.png (extraction failed)
    üîß Attempting pdf2image rescue for document_page04_img02.png...
    üìç Target: Page 4, Image 2, xref 34
    üöÄ RESCUE SUCCESS: document_page04_img02.png recovered with pdf2image!
```

#### Final Statistics
```
üéØ EXTRACTION COMPLETE:
   üìä Total images extracted: 47
   üìÅ Output directory: extracted_images_p2_silicon
   üìã Catalog saved: P2_Silicon_v35_image_catalog.json
```

### JSON Catalog Structure
**Generated File**: `[document-name]_image_catalog.json`

**Key Fields**:
- `source_pdf`: Original document path
- `extraction_summary`: Statistics and directory info  
- `images[]`: Array of image metadata objects

**Per-Image Metadata**:
- `filename`: Generated PNG filename
- `page_number` & `image_index`: Location in source
- `dimensions`, `width`, `height`: Image size data
- `file_path`: Full path to extracted PNG
- `xref`: PDF reference number (useful for failure analysis)
- `extraction_status`: "success" or "failed"
- `context`: Surrounding text analysis for captions
- `suggested_tags`: Content classification tags

### Failure Analysis Using Tool Output

#### Identifying Failure Patterns
```bash
# Look for repeated xref numbers in failures
grep "xref.*coordinate issue" extraction_log.txt

# Check for placeholder file sizes  
ls -la extracted_images_*/
# Look for files ~16KB (typical placeholder size)
```

#### Context Analysis for Manual Intervention
```json
"context": {
  "caption": "Feature Descriptions",
  "nearby_text": [
    {
      "text": "The P2 Edge Module socket is a 0.05 in pitch...",
      "distance": 21.38671875,
      "position": "below"
    }
  ],
  "potential_captions": ["Feature Descriptions", "1. Parallax P2 Edge Module Socket"]
}
```

**This context helps with**:
- Understanding what the failed image should contain
- Prioritizing manual capture efforts  
- Creating accurate asset descriptions
- Maintaining content relationship integrity

---

## üéØ TASK GENERATION & EXECUTION METHODOLOGY
*How to systematically manage extraction process through Todo MCP*

### Phase A: Selection & Task Generation
**IMMEDIATELY after user selects document for extraction:**

#### Step A1: Generate Core Extraction Tasks
**CRITICAL**: All tasks MUST use tag `["image_extraction"]` to match this work mode's filter

**Standard Single-PDF Tasks**:
```bash
# Create primary extraction sequence with proper tagging
mcp__todo-mcp__todo_create content:"Phase 1: Setup extraction environment and locate source PDF for [document-name]" priority:"critical" estimate_minutes:10 tags:["image_extraction"] sequence:1

mcp__todo-mcp__todo_create content:"Phase 2: Execute image extraction using pdf_image_extractor.py for [document-name]" priority:"critical" estimate_minutes:30 tags:["image_extraction"] sequence:2

mcp__todo-mcp__todo_create content:"Phase 3: Analyze extraction results and identify failure patterns for [document-name]" priority:"critical" estimate_minutes:20 tags:["image_extraction"] sequence:3

mcp__todo-mcp__todo_create content:"Phase 4: Create searchable asset catalog and organize visual assets for [document-name]" priority:"critical" estimate_minutes:25 tags:["image_extraction"] sequence:4

mcp__todo-mcp__todo_create content:"Phase 5: Execute consumer distribution and completeness validation for [document-name]" priority:"critical" estimate_minutes:30 tags:["image_extraction"] sequence:5

mcp__todo-mcp__todo_create content:"Phase 6: Update ALL tracking systems with extraction results for [document-name]" priority:"critical" estimate_minutes:25 tags:["image_extraction"] sequence:6
```

**Multi-Part PDF Tasks** (when document split into multiple parts):
```bash
# Create multi-part extraction sequence
mcp__todo-mcp__todo_create content:"Phase 1: Setup [N]-part extraction environment for [document-name]" priority:"critical" estimate_minutes:15 tags:["image_extraction"] sequence:1

mcp__todo-mcp__todo_create content:"Phase 2: Execute image extraction on all [N] parts of [document-name] using pdf_image_extractor.py" priority:"critical" estimate_minutes:60 tags:["image_extraction"] sequence:2

mcp__todo-mcp__todo_create content:"Phase 3: Combine extracted images from [N] parts with collision protection" priority:"critical" estimate_minutes:30 tags:["image_extraction"] sequence:3

mcp__todo-mcp__todo_create content:"Phase 4: Create comprehensive multi-part catalog and organize final assets" priority:"critical" estimate_minutes:40 tags:["image_extraction"] sequence:4

mcp__todo-mcp__todo_create content:"Phase 5: Update all tracking systems with multi-part extraction results" priority:"critical" estimate_minutes:25 tags:["image_extraction"] sequence:5

mcp__todo-mcp__todo_create content:"Phase 6: Clean up temporary directories after successful combination" priority:"critical" estimate_minutes:10 tags:["image_extraction"] sequence:6
```

#### Step A2: Set Context Tracking
```bash
# Track extraction progress and parameters
mcp__todo-mcp__context_set key:"extraction_active_[document-id]" value:"Started: [timestamp], Source: [pdf-path], Expected: [N] images, Priority: [level]"
```

### Phase B: Systematic Task Execution
**Execute tasks in sequence using the 17-step workflow:**

#### Task Execution Pattern
1. **Start next task**: `mcp__todo-mcp__todo_start position_id:1`
2. **Execute the phase work** (following workflow steps within each phase)
3. **Complete task**: `mcp__todo-mcp__todo_complete position_id:1`
4. **Generate follow-up tasks if discovered** (manual capture, integration)
5. **Move to next task**

#### Step B1: Phase 1 Execution (Setup)
**When working on Phase 1 task:**
- Execute Steps 1-3 from workflow (matrix review, PDF location, tool prep)
- If source PDF missing or inaccessible: Create resolution task
- Update task context with setup findings before completing

#### Step B2: Phase 2 Execution (Extraction)
**When working on Phase 2 task:**
- Execute Steps 4-5 from workflow (run extraction tool, analyze results)
- Monitor terminal output for success/failure patterns
- Store extraction statistics in context for reporting
- **REQUIRED**: Create Markdown catalog immediately after successful extraction

#### Step B3: Phase 3 Execution (Failure Analysis)
**When working on Phase 3 task:**
- Execute Steps 6-8 from workflow (identify patterns, assess intervention, document requirements)
- If manual capture needed: Create specific follow-up tasks immediately
- Document all failure analysis in context

#### Step B4: Phase 4 Execution (Organization)
**When working on Phase 4 task:**
- Execute Steps 9-10 from workflow (create catalogs, update matrix)
- Ensure searchable metadata and asset organization complete
- Transfer key data from context to permanent catalogs

#### Step B5: Phase 5 Execution (Consumer Distribution & Validation)
**When working on Phase 5 task:**
- Execute Steps 11-15 from workflow (consumer planning, distribution, completeness validation)
- Create all consumer reference files and registry systems
- Generate manual capture or consumer update tasks as needed
- Document validation results and consumer impact analysis

#### Step B6: Phase 6 Execution (System Integration)
**When working on Phase 6 task:**
- Execute Steps 11-17 from workflow (ALL tracking system updates + comprehensive report)
- **MANDATORY**: Update all 5 tracking documents in specified order
- Verify data consistency across all updated tracking systems
- Clear temporary context keys after completion

### Phase C: Completion & Follow-up Management

#### Step C1: Verify Completion Criteria
```bash
# Check all extraction tasks completed
mcp__todo-mcp__todo_list tags:["image_extraction"]
# Should show sequence 1-6 as completed

# Verify deliverables exist:
# - extracted_images_[document-id]/ directory with PNG files
# - JSON catalog with complete metadata
# - Updated master catalogs  
# - Matrix status updated to COMPLETE
# - ALL 5 tracking documents updated with extraction results
# - Data consistency maintained across tracking systems
```

#### Step C2: Final Context & Follow-up Tasks
```bash
# Mark extraction complete with full metrics
mcp__todo-mcp__context_set key:"extraction_complete_[document-id]" value:"Completed: [timestamp], Images: [successful]/[total], Success rate: [XX.X%], Manual capture: [needed/not-needed], Output: [directory-path]"

# Clean up active tracking
mcp__todo-mcp__context_delete key:"extraction_active_[document-id]"

# Generate follow-up tasks if needed:
# Manual capture tasks (medium priority, tagged "manual_capture")
# Integration tasks (low priority, tagged "asset_integration")
```

### Task Management Best Practices

#### Always Use Extraction-Specific Tags
- **Primary tag**: `["image_extraction"]` for main workflow  
- **Secondary tags**: `["manual_capture"]`, `["asset_integration"]` for follow-up work
- **Document-specific**: Include document identifier in content for tracking

#### Context Keys for Progress Tracking
- `extraction_active_[doc]`: Current extraction state and parameters
- `extraction_stats_[doc]`: Success rates and tool output summary
- `extraction_complete_[doc]`: Final completion record with metrics

#### Error Recovery Protocols
- If extraction tool fails: Check dependencies, try alternative approaches
- If directory issues: Create recovery tasks for asset organization
- If manual capture needed: Document exact requirements for human intervention

**This methodology ensures**: Systematic processing, complete asset capture, organized output, trackable progress, reliable intervention handling

---

## üìã SUCCESS CRITERIA

### Image Extraction Complete When:
- [ ] **Source PDF processed** using `pdf_image_extractor.py`
- [ ] **Extraction directory created** with organized PNG files and JSON catalog
- [ ] **Markdown catalog created** with human-readable metadata display for review
- [ ] **Success rate documented** with specific failure analysis if needed
- [ ] **Manual intervention assessed** and documented if required
- [ ] **Asset catalog created** with searchable metadata and content classification
- [ ] **Master catalog updated** with new visual assets integrated
- [ ] **Extraction matrix updated** from PENDING to COMPLETE status  
- [ ] **ALL tracking systems updated** (Operations Dashboard, Sources Catalog, Production Pipeline, Technical Debt, Project Master)
- [ ] **Data consistency verified** across all tracking documents
- [ ] **Follow-up tasks created** for manual capture or integration opportunities
- [ ] **Comprehensive extraction report generated** with complete metrics

---

## üö® CRITICAL RULES

### Tool Usage Requirements
- **Always use** `tools/pdf_image_extractor.py` for primary extraction
- **Never attempt** manual PDF parsing or alternative extraction methods first
- **Monitor terminal output** during extraction for real-time success/failure feedback
- **Trust tool's** placeholder detection and rescue attempt mechanisms

### Failure Handling Protocols  
- **Document all failures** with exact xref numbers and context details
- **Attempt rescue** using built-in pdf2image fallback before declaring manual capture needed
- **Prioritize manual intervention** based on content importance (technical > marketing)
- **Preserve context information** from JSON catalogs for manual capture guidance

### Asset Organization Standards
- **Initial extraction** creates temporary directory: `extracted_images_[document-identifier]`
- **REQUIRED**: Move all images to proper ingestion tree: `sources/extractions/[document-audit]/assets/images-[YYYYMMDD]/`
- **Generate complete** JSON catalogs with metadata for all extraction attempts
- **Create searchable** master catalogs with content classification tags
- **Update ALL tracking systems** immediately upon extraction completion (5 documents minimum)
- **Maintain data consistency** across all tracking documents

### Quality Assurance
- **Verify success rates** >90% for most documents (exceptions: known problematic PDFs)
- **Check context quality** for caption detection and content understanding
- **Validate asset organization** with predictable file naming and directory structure
- **Test searchability** of generated catalogs for manual creation workflows

---

**This guide covers ONLY image extraction workflow. Document ingestion and content generation get their own focused guides.**